<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AimLab SimplifiÃ©</title>
<style>
body {margin:0; overflow:hidden; font-family:sans-serif; background:#000; color:#fff;}
#canvas-container{position:fixed;top:0;left:0;width:100%;height:100%;}
#crosshair{position:fixed;top:50%;left:50%;width:4px;height:4px;background:#0f0;transform:translate(-50%,-50%);}
#shoot-btn{display:none; position:fixed; bottom:20px; right:20px; width:80px; height:80px; background:red; border-radius:50%; font-size:2rem; text-align:center; line-height:80px; cursor:pointer;}
#hud{position:fixed; top:10px; left:10px; font-size:1.5rem;}
#start-btn{position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); padding:20px 50px; font-size:1.5rem; cursor:pointer;}
</style>
</head>
<body>
<div id="canvas-container"></div>
<div id="crosshair"></div>
<div id="shoot-btn">ðŸŽ¯</div>
<div id="hud">Score: <span id="score">0</span></div>
<button id="start-btn">Commencer</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
let scene, camera, renderer;
let targets = [];
let score = 0;
let gameStarted = false;
const isMobile = 'ontouchstart' in window;

// Initialisation Three.js
function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111111);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight,0.1,100);
    camera.position.set(0,1.6,0);

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    // Sol
    const floorMat = new THREE.MeshStandardMaterial({color:0x222222});
    const floorGeo = new THREE.PlaneGeometry(20,20);
    const floor = new THREE.Mesh(floorGeo,floorMat);
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // LumiÃ¨re
    const light = new THREE.DirectionalLight(0xffffff,1);
    light.position.set(10,10,10);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0xffffff,0.3));

    createTargets();
    animate();
}

// CrÃ©e les cibles devant le joueur
function createTargets(){
    for(let i=0;i<5;i++){
        const geo = new THREE.SphereGeometry(0.3,16,16);
        const mat = new THREE.MeshStandardMaterial({color:0xff0000,emissive:0xff0000});
        const target = new THREE.Mesh(geo,mat);
        positionTarget(target);
        scene.add(target);
        targets.push(target);
    }
}

// Place la cible alÃ©atoirement devant le joueur dans le stand
function positionTarget(target){
    const distance = 2 + Math.random()*3;
    const angle = (Math.random()-0.5)*Math.PI/3;
    const height = 1 + Math.random();
    let dir = new THREE.Vector3();
    camera.getWorldDirection(dir);
    dir.y = 0; dir.normalize();
    let side = new THREE.Vector3(); side.crossVectors(new THREE.Vector3(0,1,0),dir).normalize();
    let pos = camera.position.clone().add(dir.multiplyScalar(distance)).add(side.multiplyScalar(Math.tan(angle)*distance));
    pos.y = height;
    target.position.copy(pos);
}

// Tir
function shoot(){
    let raycaster = new THREE.Raycaster();
    let dir = new THREE.Vector3(0,0,-1); dir.applyQuaternion(camera.quaternion);
    raycaster.set(camera.position,dir);
    const intersects = raycaster.intersectObjects(targets);
    if(intersects.length>0){
        const target = intersects[0].object;
        score++;
        document.getElementById('score').textContent = score;
        // Repositionnement avec transition pour Ã©viter le freeze
        const newPos = getRandomTargetPos();
        const startPos = target.position.clone();
        const duration = 300;
        const startTime = Date.now();
        function move(){
            const t = Math.min((Date.now()-startTime)/duration,1);
            target.position.lerpVectors(startPos,newPos,t);
            if(t<1) requestAnimationFrame(move);
        }
        move();
    }
}

// GÃ©nÃ¨re une nouvelle position alÃ©atoire devant la camÃ©ra
function getRandomTargetPos(){
    const distance = 2 + Math.random()*3;
    const angle = (Math.random()-0.5)*Math.PI/3;
    const height = 1 + Math.random();
    let dir = new THREE.Vector3(); camera.getWorldDirection(dir); dir.y=0; dir.normalize();
    let side = new THREE.Vector3(); side.crossVectors(new THREE.Vector3(0,1,0),dir).normalize();
    let pos = camera.position.clone().add(dir.multiplyScalar(distance)).add(side.multiplyScalar(Math.tan(angle)*distance));
    pos.y = height;
    return pos;
}

// Animation
function animate(){
    requestAnimationFrame(animate);
    renderer.render(scene,camera);
}

// DÃ©placement camÃ©ra PC
function setupControlsPC(){
    document.addEventListener('mousemove',e=>{
        if(!gameStarted) return;
        const movementX = e.movementX || 0;
        const movementY = e.movementY || 0;
        camera.rotation.y -= movementX*0.002;
        camera.rotation.x -= movementY*0.002;
        camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2,camera.rotation.x));
    });
    document.addEventListener('click',()=>{shoot(); renderer.domElement.requestPointerLock();});
}

// DÃ©placement camÃ©ra Mobile
function setupControlsMobile(){
    document.getElementById('shoot-btn').style.display='block';
    document.getElementById('shoot-btn').addEventListener('touchstart',shoot);
    let startX=0,startY=0;
    document.addEventListener('touchstart',e=>{
        if(e.touches[0].clientY<window.innerHeight*0.7){
            startX=e.touches[0].clientX; startY=e.touches[0].clientY;
        }
    });
    document.addEventListener('touchmove',e=>{
        const t = e.touches[0];
        const deltaX = t.clientX - startX;
        const deltaY = t.clientY - startY;
        camera.rotation.y -= deltaX*0.005;
        camera.rotation.x -= deltaY*0.005;
        camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2,camera.rotation.x));
        startX = t.clientX; startY=t.clientY;
    });
}

// Lancement du jeu
document.getElementById('start-btn').addEventListener('click',()=>{
    gameStarted=true;
    document.getElementById('start-btn').style.display='none';
    init();
    if(isMobile) setupControlsMobile();
    else setupControlsPC();
});
</script>
</body>
</html>
