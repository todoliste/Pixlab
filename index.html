```html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AimLab 3D Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #000;
            color: #fff;
            touch-action: none;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
        }

        #menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 20px;
            overflow-y: auto;
        }

        #menu h1 {
            font-size: clamp(2.5rem, 10vw, 5rem);
            margin-bottom: 50px;
            text-transform: uppercase;
            letter-spacing: 5px;
            background: linear-gradient(45deg, #00f5ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 245, 255, 0.5);
        }

        .mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            width: 100%;
            max-width: 900px;
            margin-bottom: 40px;
        }

        .mode-btn {
            background: rgba(0, 0, 0, 0.6);
            border: 3px solid rgba(0, 245, 255, 0.4);
            color: #fff;
            padding: 30px 20px;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 15px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .mode-btn:hover {
            background: rgba(0, 245, 255, 0.2);
            border-color: #00f5ff;
            transform: scale(1.08);
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.6);
        }

        .mode-btn.selected {
            background: rgba(0, 245, 255, 0.3);
            border-color: #00f5ff;
            box-shadow: 0 0 40px rgba(0, 245, 255, 0.8);
        }

        .mode-desc {
            font-size: 0.8rem;
            margin-top: 10px;
            opacity: 0.7;
            text-transform: none;
            letter-spacing: 1px;
        }

        .sensitivity-control {
            width: 100%;
            max-width: 450px;
            margin-bottom: 40px;
            background: rgba(0, 0, 0, 0.5);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(0, 245, 255, 0.3);
        }

        .sensitivity-control label {
            display: block;
            margin-bottom: 15px;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        .sensitivity-control input[type="range"] {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .sensitivity-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: #00f5ff;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.8);
        }

        .sensitivity-control input[type="range"]::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: #00f5ff;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.8);
            border: none;
        }

        #start-btn {
            background: linear-gradient(135deg, #00f5ff, #7b00ff);
            border: none;
            color: #fff;
            padding: 25px 80px;
            font-size: 1.8rem;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s;
            box-shadow: 0 10px 40px rgba(123, 0, 255, 0.6);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        #start-btn:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(123, 0, 255, 0.8);
        }

        #start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        #hud {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: none;
            z-index: 10;
            pointer-events: none;
        }

        #hud-top {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .hud-item {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 30px;
            border-radius: 10px;
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            border: 2px solid rgba(0, 245, 255, 0.6);
            font-weight: bold;
            letter-spacing: 2px;
        }

        #minimap {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 200px;
            height: 200px;
            background: rgba(0, 0, 0, 0.85);
            border: 3px solid rgba(0, 245, 255, 0.8);
            border-radius: 15px;
            display: none;
            z-index: 10;
            pointer-events: none;
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.4);
        }

        #minimap canvas {
            width: 100%;
            height: 100%;
            border-radius: 12px;
        }

        #crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 4px;
            background: #000;
            border-radius: 50%;
            display: none;
            pointer-events: none;
            z-index: 20;
            box-shadow: 0 0 3px rgba(255, 255, 255, 0.5);
        }

        #crosshair.dot {
            width: 4px;
            height: 4px;
            background: #000;
            border-radius: 50%;
        }

        #crosshair.sniper {
            width: 200px;
            height: 200px;
            background: transparent;
            border: 3px solid rgba(0, 255, 0, 0.8);
            border-radius: 50%;
        }

        #crosshair.sniper::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(0, 255, 0, 0.8);
            transform: translateY(-50%);
        }

        #crosshair.sniper::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(0, 255, 0, 0.8);
            transform: translateX(-50%);
        }

        #hitmarker {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            width: 60px;
            height: 60px;
            display: none;
            pointer-events: none;
            z-index: 25;
        }

        #hitmarker::before,
        #hitmarker::after {
            content: '';
            position: absolute;
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        #hitmarker::before {
            width: 3px;
            height: 25px;
            left: 50%;
            top: -5px;
            transform: translateX(-50%);
        }

        #hitmarker::after {
            width: 3px;
            height: 25px;
            left: 50%;
            bottom: -5px;
            transform: translateX(-50%);
        }

        .hitmarker-line {
            position: absolute;
            background: #00ff00;
            width: 3px;
            height: 25px;
            box-shadow: 0 0 10px #00ff00;
        }

        .hitmarker-line:nth-child(1) {
            left: -5px;
            top: 50%;
            transform: translateY(-50%) rotate(90deg);
        }

        .hitmarker-line:nth-child(2) {
            right: -5px;
            top: 50%;
            transform: translateY(-50%) rotate(90deg);
        }

        #mobile-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: none;
            z-index: 15;
            pointer-events: none;
        }

        #mobile-controls.active {
            pointer-events: auto;
        }

        .joystick-container {
            position: fixed;
            bottom: 250px;
            left: 40px;
            width: 140px;
            height: 140px;
            background: rgba(255, 255, 255, 0.15);
            border: 4px solid rgba(0, 245, 255, 0.6);
            border-radius: 50%;
            pointer-events: auto;
            touch-action: none;
        }

        .joystick {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 60px;
            height: 60px;
            background: rgba(0, 245, 255, 0.9);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.8);
            pointer-events: none;
        }

        .shoot-btn {
            position: fixed;
            bottom: 40px;
            right: 40px;
            width: 110px;
            height: 110px;
            background: rgba(255, 50, 50, 0.4);
            border: 5px solid rgba(255, 50, 50, 0.8);
            border-radius: 50%;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 0 30px rgba(255, 50, 50, 0.6);
            touch-action: none;
        }

        .shoot-btn:active {
            background: rgba(255, 50, 50, 0.7);
            transform: scale(0.92);
        }

        .aim-btn {
            position: fixed;
            bottom: 180px;
            right: 40px;
            width: 90px;
            height: 90px;
            background: rgba(0, 245, 255, 0.4);
            border: 4px solid rgba(0, 245, 255, 0.8);
            border-radius: 50%;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.6);
            touch-action: none;
        }

        .aim-btn:active {
            background: rgba(0, 245, 255, 0.7);
            transform: scale(0.92);
        }

        #end-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        #end-screen h2 {
            font-size: clamp(2.5rem, 8vw, 4rem);
            margin-bottom: 40px;
            text-transform: uppercase;
            background: linear-gradient(45deg, #00f5ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats {
            background: rgba(0, 0, 0, 0.7);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 40px;
            min-width: 350px;
            border: 3px solid rgba(0, 245, 255, 0.5);
        }

        .stat-line {
            font-size: clamp(1.3rem, 5vw, 1.8rem);
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            gap: 30px;
            letter-spacing: 1px;
        }

        #restart-btn {
            background: linear-gradient(135deg, #00f5ff, #7b00ff);
            border: none;
            color: #fff;
            padding: 20px 60px;
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #restart-btn:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .mode-grid {
                grid-template-columns: 1fr;
            }

            .joystick-container {
                width: 120px;
                height: 120px;
                bottom: 250px;
                left: 30px;
            }

            .shoot-btn {
                width: 90px;
                height: 90px;
                bottom: 30px;
                right: 30px;
            }

            .aim-btn {
                width: 70px;
                height: 70px;
                bottom: 140px;
                right: 30px;
            }

            #minimap {
                width: 150px;
                height: 150px;
                bottom: 20px;
                left: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>AimLab</h1>
        <div class="mode-grid">
            <button class="mode-btn" data-mode="gridshot">
                Gridshot
                <div class="mode-desc">Cibles statiques en grille - Vandal</div>
            </button>
            <button class="mode-btn" data-mode="sixshot">
                Sixshot
                <div class="mode-desc">6 cibles rapides - Vandal</div>
            </button>
            <button class="mode-btn" data-mode="tracking">
                Tracking
                <div class="mode-desc">Suivre la cible - Vandal</div>
            </button>
            <button class="mode-btn" data-mode="sniper">
                Sniper
                <div class="mode-desc">PrÃ©cision longue distance - Sniper</div>
            </button>
            <button class="mode-btn" data-mode="spidershot">
                Spidershot
                <div class="mode-desc">Multiples cibles - Vandal</div>
            </button>
        </div>
        <div class="sensitivity-control">
            <label>SensibilitÃ©: <span id="sens-value">1.5</span></label>
            <input type="range" id="sensitivity" min="0.3" max="5" step="0.1" value="1.5">
        </div>
        <button id="start-btn" disabled>Choisis un mode</button>
    </div>

    <div id="canvas-container"></div>

    <div id="hud">
        <div id="hud-top">
            <div class="hud-item">SCORE: <span id="score">0</span></div>
            <div class="hud-item">TIME: <span id="timer">60</span></div>
            <div class="hud-item">ACCURACY: <span id="accuracy">100%</span></div>
        </div>
    </div>

    <div id="minimap">
        <canvas id="minimap-canvas"></canvas>
    </div>

    <div id="crosshair" class="dot"></div>
    <div id="hitmarker">
        <div class="hitmarker-line"></div>
        <div class="hitmarker-line"></div>
    </div>

    <div id="mobile-controls">
        <div class="joystick-container">
            <div class="joystick" id="joystick"></div>
        </div>
        <div class="aim-btn" id="aim-btn">ðŸŽ¯</div>
        <div class="shoot-btn" id="shoot-btn">ðŸ’¥</div>
    </div>

    <div id="end-screen">
        <h2>RÃ‰SULTATS</h2>
        <div class="stats">
            <div class="stat-line"><span>Score:</span> <span id="final-score">0</span></div>
            <div class="stat-line"><span>PrÃ©cision:</span> <span id="final-accuracy">0%</span></div>
            <div class="stat-line"><span>Hits:</span> <span id="final-hits">0</span></div>
        </div>
        <button id="restart-btn">Rejouer</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        const isMobile = 'ontouchstart' in window;

        const config = {
            mode: null,
            sensitivity: 1.5,
            gameTime: 60,
            score: 0,
            hits: 0,
            totalShots: 0,
            isPlaying: false,
            targets: [],
            isAiming: false
        };

        const modes = {
            gridshot: {
                targetCount: 1,
                targetSize: 1.2,
                targetSpeed: 0,
                spawnDelay: 0,
                scorePerHit: 100,
                spawnPattern: 'grid',
                weapon: 'vandal',
                mapType: 'training'
            },
            sixshot: {
                targetCount: 6,
                targetSize: 1,
                targetSpeed: 0,
                spawnDelay: 0,
                scorePerHit: 50,
                spawnPattern: 'front',
                weapon: 'vandal',
                mapType: 'training'
            },
            tracking: {
                targetCount: 1,
                targetSize: 1.3,
                targetSpeed: 0.08,
                spawnDelay: 0,
                scorePerHit: 10,
                spawnPattern: 'front',
                continuous: true,
                weapon: 'vandal',
                mapType: 'training'
            },
            sniper: {
                targetCount: 1,
                targetSize: 0.6,
                targetSpeed: 0,
                spawnDelay: 500,
                scorePerHit: 250,
                spawnPattern: 'sniper',
                weapon: 'sniper',
                mapType: 'sniper'
            },
            spidershot: {
                targetCount: 8,
                targetSize: 0.8,
                targetSpeed: 0,
                spawnDelay: 0,
                scorePerHit: 75,
                spawnPattern: 'circle-front',
                weapon: 'vandal',
                mapType: 'training'
            }
        };

        let scene, camera, renderer, raycaster;
        let weapon, weaponGroup;
        let gameLoop, timerInterval;
        let startTime;
        let keys = {};
        let velocity = new THREE.Vector3();
        let direction = new THREE.Vector3();
        let prevTime = performance.now();
        let minimapCanvas, minimapCtx;

        // Mobile controls
        let joystickActive = false;
        let joystickStart = { x: 0, y: 0 };
        let joystickCurrent = { x: 0, y: 0 };
        let touchLookStartX = 0, touchLookStartY = 0;

        // DOM
        const menu = document.getElementById('menu');
        const canvasContainer = document.getElementById('canvas-container');
        const hud = document.getElementById('hud');
        const crosshair = document.getElementById('crosshair');
        const hitmarker = document.getElementById('hitmarker');
        const endScreen = document.getElementById('end-screen');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const modeBtns = document.querySelectorAll('.mode-btn');
        const sensitivitySlider = document.getElementById('sensitivity');
        const sensValue = document.getElementById('sens-value');
        const mobileControls = document.getElementById('mobile-controls');
        const joystickElement = document.getElementById('joystick');
        const shootBtn = document.getElementById('shoot-btn');
        const aimBtn = document.getElementById('aim-btn');
        const minimap = document.getElementById('minimap');

        // Menu event listeners
        modeBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                modeBtns.forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                config.mode = this.dataset.mode;
                startBtn.disabled = false;
                startBtn.textContent = 'DÃ‰MARRER';
            });
        });

        sensitivitySlider.addEventListener('input', function(e) {
            config.sensitivity = parseFloat(e.target.value);
            sensValue.textContent = config.sensitivity.toFixed(1);
        });

        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', function() {
            endScreen.style.display = 'none';
            menu.style.display = 'flex';
        });

        function initMinimap() {
            minimapCanvas = document.getElementById('minimap-canvas');
            minimapCanvas.width = 200;
            minimapCanvas.height = 200;
            minimapCtx = minimapCanvas.getContext('2d');
        }

        function drawMinimap() {
            if (!minimapCtx) return;

            minimapCtx.clearRect(0, 0, 200, 200);

            // Fond de la minimap
            minimapCtx.fillStyle = 'rgba(10, 10, 20, 0.9)';
            minimapCtx.fillRect(0, 0, 200, 200);

            // Grille
            minimapCtx.strokeStyle = 'rgba(0, 245, 255, 0.2)';
            minimapCtx.lineWidth = 1;
            for (let i = 0; i <= 200; i += 40) {
                minimapCtx.beginPath();
                minimapCtx.moveTo(i, 0);
                minimapCtx.lineTo(i, 200);
                minimapCtx.stroke();
                minimapCtx.beginPath();
                minimapCtx.moveTo(0, i);
                minimapCtx.lineTo(200, i);
                minimapCtx.stroke();
            }

            // Convertir les coordonnÃ©es 3D en 2D pour la minimap
            const scale = 2;
            const centerX = 100;
            const centerY = 100;

            // Dessiner les cibles
            config.targets.forEach(target => {
                if (!target.userData.isActive) return;

                const x = centerX + target.position.x * scale;
                const y = centerY + target.position.z * scale;

                minimapCtx.fillStyle = '#ff3344';
                minimapCtx.beginPath();
                minimapCtx.arc(x, y, 5, 0, Math.PI * 2);
                minimapCtx.fill();

                // Bordure
                minimapCtx.strokeStyle = '#ff0000';
                minimapCtx.lineWidth = 2;
                minimapCtx.stroke();
            });

            // Dessiner le joueur
            const playerX = centerX + camera.position.x * scale;
            const playerY = centerY + camera.position.z * scale;

            // Direction du joueur
            const angle = -camera.rotation.y;
            const dirLength = 15;

            minimapCtx.save();
            minimapCtx.translate(playerX, playerY);
            minimapCtx.rotate(angle);

            // Triangle reprÃ©sentant le joueur
            minimapCtx.fillStyle = '#00f5ff';
            minimapCtx.beginPath();
            minimapCtx.moveTo(0, -8);
            minimapCtx.lineTo(-6, 6);
            minimapCtx.lineTo(6, 6);
            minimapCtx.closePath();
            minimapCtx.fill();

            // Bordure du triangle
            minimapCtx.strokeStyle = '#00d4ff';
            minimapCtx.lineWidth = 2;
            minimapCtx.stroke();

            minimapCtx.restore();
        }

        function initThree() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87ceeb);
            scene.fog = new THREE.Fog(0x87ceeb, 50, 150);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.7, 5);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            canvasContainer.appendChild(renderer.domElement);

            raycaster = new THREE.Raycaster();

            const modeConfig = modes[config.mode];
            if (modeConfig.mapType === 'sniper') {
                createSniperMap();
            } else {
                createTrainingMap();
            }

            createWeapon();
            createTargets();
            initMinimap();

            window.addEventListener('resize', onWindowResize);

            if (isMobile) {
                setupMobileControls();
            } else {
                setupPCControls();
            }
        }

        function createTrainingMap() {
            // Sol avec texture
            const floorGeometry = new THREE.PlaneGeometry(200, 200);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x4a4a4a,
                roughness: 0.8,
                metalness: 0.2
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Grille au sol
            const gridHelper = new THREE.GridHelper(200, 100, 0x00f5ff, 0x333333);
            gridHelper.position.y = 0.01;
            scene.add(gridHelper);

            // Murs
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0x2a2a3e,
                roughness: 0.7
            });

            const wallHeight = 10;
            const wallThickness = 1;

            // Mur arriÃ¨re
            const backWallGeometry = new THREE.BoxGeometry(200, wallHeight, wallThickness);
            const backWall = new THREE.Mesh(backWallGeometry, wallMaterial);
            backWall.position.set(0, wallHeight/2, -100);
            backWall.receiveShadow = true;
            scene.add(backWall);

            // Murs latÃ©raux
            const sideWallGeometry = new THREE.BoxGeometry(wallThickness, wallHeight, 200);
            
            const leftWall = new THREE.Mesh(sideWallGeometry, wallMaterial);
            leftWall.position.set(-100, wallHeight/2, 0);
            leftWall.receiveShadow = true;
            scene.add(leftWall);

            const rightWall = new THREE.Mesh(sideWallGeometry, wallMaterial);
            rightWall.position.set(100, wallHeight/2, 0);
            rightWall.receiveShadow = true;
            scene.add(rightWall);

            // Plafond
            const ceilingGeometry = new THREE.PlaneGeometry(200, 200);
            const ceilingMaterial = new THREE.MeshStandardMaterial({
                color: 0x1a1a2e,
                roughness: 0.9,
                side: THREE.DoubleSide
            });
            const ceiling = new THREE.Mesh(ceilingGeometry, ceilingMaterial);
            ceiling.rotation.x = Math.PI / 2;
            ceiling.position.y = wallHeight;
            scene.add(ceiling);

            // Ã‰clairage
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);

            const mainLight = new THREE.DirectionalLight(0