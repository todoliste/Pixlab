<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Brainrot Sahur Extrême</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin:0;
  font-family:sans-serif;
  background:#121212;
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:15px;
}
h1 {margin-bottom:10px; font-size:20px; text-align:center;}
#canvasContainer {
  position:relative;
  width:100%;
  max-width:400px;
  border-radius:12px;
  overflow:hidden;
  background:#000;
  touch-action:none;
}
canvas {
  width:100%;
  display:block;
  cursor:grab;
}
#controls {
  margin-top:10px;
  width:100%;
  max-width:400px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.control-row {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}
input, select, button {
  padding:10px;
  font-size:14px;
  border-radius:8px;
  border:none;
}
button {cursor:pointer; background:#0f0; color:#000; font-weight:bold; flex:1;}
input[type="range"] {flex:1;}
select {flex:1;}
</style>
</head>
<body>
<h1>Brainrot Sahur Extrême</h1>
<div id="canvasContainer">
  <canvas id="canvas"></canvas>
</div>
<div id="controls">
  <div class="control-row">
    <select id="shape">
      <option value="rect">Rectangle</option>
      <option value="circle">Cercle</option>
    </select>
    <input type="range" id="blurRange" min="0" max="30" value="10">
  </div>
  <div class="control-row">
    <button id="increase">Agrandir</button>
    <button id="decrease">Réduire</button>
  </div>
  <div class="control-row">
    <button id="reset">Réinitialiser</button>
    <button id="mode2014">Mode Brainrot Extrême</button>
    <button id="export">Exporter</button>
  </div>
</div>

<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const shapeSelect=document.getElementById('shape');
const blurRange=document.getElementById('blurRange');
const increaseBtn=document.getElementById('increase');
const decreaseBtn=document.getElementById('decrease');
const resetBtn=document.getElementById('reset');
const exportBtn=document.getElementById('export');
const modeBtn=document.getElementById('mode2014');

let img=new Image();
img.crossOrigin="anonymous";
img.src="https://static.wikia.nocookie.net/character-stats-and-profiles/images/5/52/Sahur2.webp/revision/latest?cb=20250510085254";

let imgScale=1, imgX=0, imgY=0;
let mask={x:50,y:50,w:200,h:200};
let dragging=false, dragOffsetX, dragOffsetY;
let brainrot=false;

img.onload=()=>{
  const maxWidth=400, maxHeight=400;
  let scale=Math.min(maxWidth/img.width,maxHeight/img.height,1);
  canvas.width=img.width*scale;
  canvas.height=img.height*scale;
  imgScale=scale;
  requestAnimationFrame(draw); // start animation
};

// Drag & Drop
function getXY(e){
  const rect=canvas.getBoundingClientRect();
  if(e.touches) return {x:e.touches[0].clientX-rect.left, y:e.touches[0].clientY-rect.top};
  return {x:e.clientX-rect.left, y:e.clientY-rect.top};
}
function startDrag(e){
  const {x,y}=getXY(e);
  if(shapeSelect.value==='rect' && x>mask.x && x<mask.x+mask.w && y>mask.y && y<mask.y+mask.h){
    dragging=true; dragOffsetX=x-mask.x; dragOffsetY=y-mask.y;
  } else if(shapeSelect.value==='circle'){
    const cx=mask.x+mask.w/2, cy=mask.y+mask.h/2;
    const r=Math.min(mask.w,mask.h)/2;
    if(Math.hypot(x-cx,y-cy)<=r){dragging=true; dragOffsetX=x-mask.x; dragOffsetY=y-mask.y;}
  }
}
function moveDrag(e){
  if(!dragging) return;
  const {x,y}=getXY(e);
  mask.x=x-dragOffsetX;
  mask.y=y-dragOffsetY;
}
function endDrag(){dragging=false;}

canvas.addEventListener('mousedown',startDrag);
canvas.addEventListener('mousemove',moveDrag);
canvas.addEventListener('mouseup',endDrag);
canvas.addEventListener('mouseleave',endDrag);
canvas.addEventListener('touchstart',e=>{startDrag(e); e.preventDefault();});
canvas.addEventListener('touchmove',e=>{moveDrag(e); e.preventDefault();});
canvas.addEventListener('touchend',endDrag);

// Boutons
increaseBtn.addEventListener('click',()=>{mask.w+=20;mask.h+=20;});
decreaseBtn.addEventListener('click',()=>{mask.w=Math.max(20,mask.w-20);mask.h=Math.max(20,mask.h-20);});
resetBtn.addEventListener('click',()=>{mask={x:50,y:50,w:200,h:200};});
modeBtn.addEventListener('click',()=>{brainrot=!brainrot;});
exportBtn.addEventListener('click',()=>{
  const link=document.createElement('a');
  link.download='brainrot_sahur_extreme.png';
  link.href=canvas.toDataURL('image/png');
  link.click();
});

blurRange.addEventListener('input',()=>{});

// Draw loop
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.save();
  if(brainrot){
    // Tremblement rapide + glitch horizontal
    const shakeX=(Math.random()-0.5)*20;
    const shakeY=(Math.random()-0.5)*20;
    ctx.translate(shakeX,shakeY);

    // Décalage horizontal aléatoire pour glitch
    const glitchOffset=Math.random()*15-7;
    ctx.drawImage(img,imgX+glitchOffset,imgY,img.width*imgScale,img.height*imgScale);
  } else {
    ctx.drawImage(img,imgX,imgY,img.width*imgScale,img.height*imgScale);
  }

  if(brainrot){
    const imageData=ctx.getImageData(0,0,canvas.width,canvas.height);
    const data=imageData.data;
    for(let i=0;i<data.length;i+=4){
      let r=data[i], g=data[i+1], b=data[i+2];
      // RGB Brainrot + bruit aléatoire
      data[i]=Math.min(255,r+Math.random()*100);
      data[i+1]=Math.min(255,b+Math.random()*100);
      data[i+2]=Math.min(255,g+Math.random()*100);
    }
    ctx.putImageData(imageData,0,0);
  }
  ctx.restore();

  // Masque flou
  ctx.save();
  ctx.filter=`blur(${blurRange.value}px)`;
  ctx.beginPath();
  if(shapeSelect.value==='rect') ctx.rect(mask.x,mask.y,mask.w,mask.h);
  else ctx.arc(mask.x+mask.w/2,mask.y+mask.h/2,Math.min(mask.w,mask.h)/2,0,Math.PI*2);
  ctx.clip();
  ctx.drawImage(img,imgX,imgY,img.width*imgScale,img.height*imgScale);
  ctx.filter=`blur(${blurRange.value/2}px)`;
  ctx.drawImage(img,imgX,imgY,img.width*imgScale,img.height*imgScale);
  ctx.restore();

  requestAnimationFrame(draw);
}
</script>
</body>
</html>