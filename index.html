<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>PixLab â€“ Photo Editor</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #0a0a0a;
        color: white;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    header {
        padding: 15px 25px;
        background: #000;
        font-size: 26px;
        font-weight: bold;
        border-bottom: 1px solid #222;
        letter-spacing: 1px;
    }

    #editor {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
        background: #111;
    }

    #cropContainer {
        position: relative;
        max-width: 80%;
        max-height: 80%;
        overflow: hidden;
        border: 1px dashed #555;
    }

    #imageDisplay {
        position: absolute;
        top: 0;
        left: 0;
        transform-origin: center center;
        cursor: grab;
        user-select: none;
    }

    #cropArea {
        border: 2px solid #00d4ff;
        position: absolute;
        resize: both;
        overflow: hidden;
        pointer-events: auto;
    }

    footer {
        padding: 15px;
        background: #000;
        border-top: 1px solid #222;
        display: flex;
        justify-content: center;
        gap: 15px;
    }

    button {
        padding: 12px 18px;
        background: #00d4ff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
        color: #000;
        font-weight: bold;
        transition: 0.2s;
    }

    button:hover {
        opacity: 0.8;
    }

    #fileInput {
        display: none;
    }
</style>
</head>
<body>

<header>ðŸ“¸ PixLab</header>

<div id="editor">
    <div id="cropContainer">
        <img id="imageDisplay">
        <div id="cropArea" style="width:150px; height:150px; top:50px; left:50px;"></div>
    </div>
</div>

<footer>
    <button onclick="document.getElementById('fileInput').click()">Importer</button>
    <button onclick="resetCrop()">Reset</button>
    <button onclick="applyCrop()">Exporter</button>
</footer>

<input type="file" id="fileInput" accept="image/*">

<script>
let imageDisplay = document.getElementById("imageDisplay");
let cropArea = document.getElementById("cropArea");
let cropContainer = document.getElementById("cropContainer");

let currentZoom = 1;
let imgPos = { x: 0, y: 0 };
let drag = false;
let dragStart = { x: 0, y: 0 };

document.getElementById("fileInput").addEventListener("change", (e) => {
    let file = e.target.files[0];
    if (!file) return;

    let url = URL.createObjectURL(file);
    imageDisplay.src = url;

    imageDisplay.onload = () => {
        currentZoom = 1;
        imgPos = { x: 0, y: 0 };
        updateImageTransform();
    };
});

function updateImageTransform() {
    imageDisplay.style.transform = `translate(${imgPos.x}px, ${imgPos.y}px) scale(${currentZoom})`;
}

/* --- DÃ©placement image --- */
imageDisplay.addEventListener("mousedown", (e) => {
    drag = true;
    dragStart.x = e.clientX - imgPos.x;
    dragStart.y = e.clientY - imgPos.y;
    imageDisplay.style.cursor = "grabbing";
});

document.addEventListener("mouseup", () => {
    drag = false;
    imageDisplay.style.cursor = "grab";
});

document.addEventListener("mousemove", (e) => {
    if (!drag) return;
    imgPos.x = e.clientX - dragStart.x;
    imgPos.y = e.clientY - dragStart.y;
    updateImageTransform();
});

/* --- Zoom avec molette --- */
document.addEventListener("wheel", (e) => {
    e.preventDefault();
    currentZoom += e.deltaY * -0.001;
    currentZoom = Math.min(Math.max(0.2, currentZoom), 5);
    updateImageTransform();
}, { passive: false });

/* --- Reset crop + image --- */
function resetCrop() {
    currentZoom = 1;
    imgPos = { x: 0, y: 0 };
    cropArea.style.left = "50px";
    cropArea.style.top = "50px";
    cropArea.style.width = "150px";
    cropArea.style.height = "150px";
    updateImageTransform();
}

/* --- Export rÃ©el sans image noire --- */
function applyCrop() {
    const img = imageDisplay;
    const crop = cropArea;
    const container = cropContainer;

    const imgNatW = img.naturalWidth;
    const imgNatH = img.naturalHeight;

    const displayW = imgNatW * currentZoom;
    const displayH = imgNatH * currentZoom;

    const scaleX = imgNatW / displayW;
    const scaleY = imgNatH / displayH;

    const imgRect = img.getBoundingClientRect();
    const cropRect = crop.getBoundingClientRect();

    const offsetX = (cropRect.left - imgRect.left) * scaleX;
    const offsetY = (cropRect.top - imgRect.top) * scaleY;
    const cropW = cropRect.width * scaleX;
    const cropH = cropRect.height * scaleY;

    let canvas = document.createElement("canvas");
    canvas.width = cropW;
    canvas.height = cropH;

    let ctx = canvas.getContext("2d");

    ctx.drawImage(
        img,
        offsetX,
        offsetY,
        cropW,
        cropH,
        0,
        0,
        cropW,
        cropH
    );

    let link = document.createElement("a");
    link.download = "pixlab_crop.png";
    link.href = canvas.toDataURL();
    link.click();
}
</script>

</body>
</html>