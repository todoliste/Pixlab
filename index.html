<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AimLab Mobile V3</title>
<style>
body, html {margin:0; padding:0; overflow:hidden; background:#000;}
#crosshair{
    position:fixed;
    top:50%;
    left:50%;
    width:6px;
    height:6px;
    background:#0f0;
    border-radius:50%;
    transform:translate(-50%,-50%);
    z-index:10;
}
#shoot-btn{
    position:fixed;
    bottom:20px;
    right:20px;
    width:70px;
    height:70px;
    background:red;
    border-radius:50%;
    font-size:2rem;
    text-align:center;
    line-height:70px;
    z-index:10;
    user-select:none;
    touch-action:none;
}
#score-hud{
    position:fixed;
    top:10px;
    left:10px;
    font-size:1.5rem;
    color:white;
    z-index:10;
}
#start-btn{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    padding:20px 50px;
    font-size:1.5rem;
    cursor:pointer;
    z-index:10;
}
</style>
</head>
<body>
<div id="crosshair"></div>
<div id="shoot-btn">ðŸŽ¯</div>
<div id="score-hud">Score: <span id="score">0</span></div>
<button id="start-btn">Commencer</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
let scene, camera, renderer;
let targets = [];
let score = 0;
let gameStarted = false;
const isMobile = 'ontouchstart' in window;

// --- INIT SCENE ---
function init(){
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111111);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight,0.1,100);
    camera.position.set(0,1.6,0);

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const light = new THREE.DirectionalLight(0xffffff,1);
    light.position.set(5,10,5);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0xffffff,0.3));

    createTargets();
    animate();
}

// --- CREATE TARGETS ---
function createTargets(){
    for(let i=0;i<5;i++){
        const geo = new THREE.SphereGeometry(0.3,16,16);
        const mat = new THREE.MeshStandardMaterial({color:0xff0000,emissive:0xff0000});
        const target = new THREE.Mesh(geo,mat);
        spawnTarget(target);
        target.userData.moving = (i<2);
        target.userData.dir = 1;
        scene.add(target);
        targets.push(target);
    }
}

// --- SPAWN CIBLE DEVANT CAMERA ---
function spawnTarget(target){
    const distance = 3 + Math.random()*3; // 3-6m devant
    const angle = (Math.random()-0.5) * Math.PI/6; // lÃ©ger angle
    const height = 1 + Math.random()*1.5;

    const dir = new THREE.Vector3();
    camera.getWorldDirection(dir);
    dir.y = 0;
    dir.normalize();

    const side = new THREE.Vector3();
    side.crossVectors(new THREE.Vector3(0,1,0),dir).normalize();

    const pos = camera.position.clone().add(dir.multiplyScalar(distance))
        .add(side.multiplyScalar(Math.tan(angle)*distance));
    pos.y = height;
    target.position.copy(pos);
}

// --- SHOOT ---
function shoot(){
    const ray = new THREE.Raycaster(camera.position, new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion));
    const hits = ray.intersectObjects(targets);
    if(hits.length>0){
        const t = hits[0].object;
        score++;
        document.getElementById('score').textContent = score;
        spawnTarget(t); // reposition instantanÃ©, plus de freeze
    }
}

// --- ANIMATE TARGETS ---
function animateTargets(){
    targets.forEach(t=>{
        if(t.userData.moving){
            t.position.x += 0.01*t.userData.dir;
            if(t.position.x > camera.position.x + 2) t.userData.dir = -1;
            if(t.position.x < camera.position.x - 2) t.userData.dir = 1;
        }
    });
}

// --- ANIMATION LOOP ---
function animate(){
    requestAnimationFrame(animate);
    animateTargets();
    renderer.render(scene,camera);
}

// --- CONTROLES MOBILE ---
function setupMobileControls(){
    const shootBtn = document.getElementById('shoot-btn');
    shootBtn.style.display='block';
    shootBtn.addEventListener('touchstart', shoot);

    let lastX=0, lastY=0;
    document.addEventListener('touchstart', e=>{
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
    });
    document.addEventListener('touchmove', e=>{
        const t = e.touches[0];
        const dx = t.clientX - lastX;
        const dy = t.clientY - lastY;
        camera.rotation.y -= dx*0.005;
        camera.rotation.x -= dy*0.005;
        camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
        lastX = t.clientX;
        lastY = t.clientY;
    });
}

// --- START GAME ---
document.getElementById('start-btn').addEventListener('click', ()=>{
    gameStarted = true;
    document.getElementById('start-btn').style.display='none';
    init();
    if(isMobile) setupMobileControls();
});
</script>
</body>
</html>
