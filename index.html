<!doctype html>

<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Stretch - Music Trend</title>
  <style>
    :root{ --bg:#0f1724; --card:#0b1220; --accent:#06b6d4; color-scheme: dark; }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#071029 0%, #0b1220 100%); color:#e6eef8}
    .wrap{max-width:1000px;margin:24px auto;padding:18px;background:rgba(255,255,255,0.03);border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 12px;font-size:20px}
    .top{display:flex;gap:12px;align-items:center}
    .controls{min-width:260px;padding:12px;background:rgba(255,255,255,0.02);border-radius:8px}
    label{display:block;font-size:13px;margin:8px 0}
    input[type=range]{width:100%}
    canvas{background:#071428;border-radius:8px;display:block;max-width:100%;}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .small{font-size:13px;color:#bcd}
    button{background:var(--accent);border:none;color:#042; padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .muted{opacity:0.8}
    .footer{margin-top:12px;font-size:13px;color:#a9bed0}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Image Stretch — Trend Music (HTML)</h1>
    <div>
  <input id="file" type="file" accept="image/*" style="margin-bottom:10px;">
  <canvas id="canvas" width="720" height="720"></canvas>
</div><label>Scale Y (vertical stretch)</label>
    <input id="scaleY" type="range" min="0.2" max="3" step="0.01" value="1">
    <div class="small">Valeur: <span id="syVal">1.00</span></div>

    <label><input id="keepAspect" type="checkbox" checked> Keep aspect ratio when changing X</label>

    <div style="margin-top:8px;display:flex;gap:8px">
      <button id="apply">Apply</button>
      <button id="download">Download PNG</button>
      <button id="reset">Reset</button>
    </div>

    <p class="muted small" style="margin-top:8px">Tip: Use Scale X > 1 to stretch horizontally (popular for music trend visuals). You can re-upload another image anytime.</p>
  </div>

  <div class="col">
    <canvas id="canvas" width="720" height="720"></canvas>
    <div class="footer">Preview — canvas sized to square 720×720 for easy use on social platforms. The final downloaded image keeps that size.</div>
  </div>
</div>

  </div><script>
const file = document.getElementById('file');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let img = new Image();
let imgLoaded = false;

let isDragging = false;
let startDist = 0;
let scaleX = 1;
let scaleY = 1;

function clearCanvas(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#071428';
  ctx.fillRect(0,0,canvas.width,canvas.height);
}
clearCanvas();

file.addEventListener('change', e=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  img = new Image();
  img.onload = ()=>{
    imgLoaded = true;
    scaleX = 1;
    scaleY = 1;
    draw();
    URL.revokeObjectURL(url);
  }
  img.src = url;
});

function getDistFromCenter(e){
  let rect = canvas.getBoundingClientRect();
  let x = e.clientX - rect.left;
  let y = e.clientY - rect.top;
  let cx = canvas.width / 2;
  let cy = canvas.height / 2;
  return Math.hypot(x - cx, y - cy);
}

canvas.addEventListener('mousedown', e=>{
  if(!imgLoaded) return;
  isDragging = true;
  startDist = getDistFromCenter(e);
});

canvas.addEventListener('mouseup', ()=>{
  isDragging = false;
});

canvas.addEventListener('mouseleave', ()=>{
  isDragging = false;
});

canvas.addEventListener('mousemove', e=>{
  if(!isDragging || !imgLoaded) return;

  let dist = getDistFromCenter(e);
  let factor = dist / startDist;

  scaleX = Math.max(0.3, Math.min(3, factor));
  scaleY = scaleX;

  draw();
});

function draw(){
  clearCanvas();
  const cw = canvas.width;
  const ch = canvas.height;

  let baseScale = Math.max(cw / img.width, ch / img.height);
  const baseW = img.width * baseScale;
  const baseH = img.height * baseScale;

  const finalW = baseW * scaleX;
  const finalH = baseH * scaleY;

  const dx = (cw - finalW) / 2;
  const dy = (ch - finalH) / 2;

  ctx.drawImage(img, dx, dy, finalW, finalH);
}
</script></body>
</html>