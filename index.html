<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AimLab 3D</title>
<style>
  body {margin:0; padding:0; overflow:hidden; background:#000; color:#fff; font-family:sans-serif;}
  #menu, #end-screen {position:fixed; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center; background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);}
  #menu h1, #end-screen h2 {font-size:4rem; background:linear-gradient(45deg,#00f5ff,#ff00ff); -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
  .mode-btn {margin:10px; padding:20px 40px; font-size:1.5rem; cursor:pointer; border:2px solid #00f5ff; border-radius:15px; background:rgba(0,0,0,0.5); transition:0.3s;}
  .mode-btn:hover{transform:scale(1.1); box-shadow:0 0 20px #00f5ff;}
  #start-btn, #restart-btn {margin-top:30px; padding:20px 60px; font-size:1.8rem; border:none; border-radius:50px; cursor:pointer; background:linear-gradient(135deg,#00f5ff,#7b00ff);}
  #canvas-container {position:fixed; top:0; left:0; width:100%; height:100%; display:none;}
  #hud{position:fixed; top:0; left:0; width:100%; display:flex; justify-content:space-around; padding:10px; display:none;}
  .hud-item{background:rgba(0,0,0,0.6); padding:10px 20px; border-radius:10px;}
  #crosshair{position:fixed; top:50%; left:50%; width:4px; height:4px; background:#0f0; transform:translate(-50%,-50%);}
</style>
</head>
<body>
<div id="menu">
  <h1>AimLab 3D</h1>
  <div>
    <button class="mode-btn" data-mode="gridshot">Gridshot</button>
    <button class="mode-btn" data-mode="tracking">Tracking</button>
    <button class="mode-btn" data-mode="sixshot">Sixshot</button>
  </div>
  <button id="start-btn" disabled>Commencer</button>
</div>

<div id="canvas-container"></div>
<div id="hud">
  <div class="hud-item">Score: <span id="score">0</span></div>
  <div class="hud-item">Timer: <span id="timer">60</span></div>
</div>
<div id="crosshair"></div>

<div id="end-screen">
  <h2>Résultats</h2>
  <div>Score: <span id="final-score">0</span></div>
  <button id="restart-btn">Rejouer</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
let scene, camera, renderer;
let controls = {forward:false,back:false,left:false,right:false};
let targets=[], score=0, timeLeft=60, gameInterval;
let config = {mode:null};

const menu = document.getElementById('menu');
const startBtn = document.getElementById('start-btn');
const modeBtns = document.querySelectorAll('.mode-btn');
const canvasContainer = document.getElementById('canvas-container');
const hud = document.getElementById('hud');
const scoreEl = document.getElementById('score');
const timerEl = document.getElementById('timer');
const endScreen = document.getElementById('end-screen');
const finalScore = document.getElementById('final-score');
const restartBtn = document.getElementById('restart-btn');

modeBtns.forEach(btn=>{
  btn.addEventListener('click',()=>{
    modeBtns.forEach(b=>b.style.borderColor='#00f5ff');
    btn.style.borderColor='#ff0';
    config.mode = btn.dataset.mode;
    startBtn.disabled=false;
  });
});

startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', ()=>location.reload());

function initThree(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x1a1a2e);
  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight,0.1,1000);
  camera.position.set(0,1.6,5);
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  canvasContainer.appendChild(renderer.domElement);

  // Lumières
  let light = new THREE.DirectionalLight(0xffffff,1);
  light.position.set(5,10,5); scene.add(light);
  scene.add(new THREE.AmbientLight(0x404040));

  // Sol
  const floor = new THREE.Mesh(new THREE.PlaneGeometry(50,50), new THREE.MeshStandardMaterial({color:0x111111}));
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);

  createWeapon();
  createTargets();
  animate();
  document.addEventListener('keydown', e=>{if(e.code==='KeyW')controls.forward=true;if(e.code==='KeyS')controls.back=true;if(e.code==='KeyA')controls.left=true;if(e.code==='KeyD')controls.right=true;});
  document.addEventListener('keyup', e=>{if(e.code==='KeyW')controls.forward=false;if(e.code==='KeyS')controls.back=false;if(e.code==='KeyA')controls.left=false;if(e.code==='KeyD')controls.right=false;});
  renderer.domElement.addEventListener('click', shoot);
}

function createWeapon(){
  let weapon = new THREE.Mesh(new THREE.BoxGeometry(0.1,0.1,0.5), new THREE.MeshStandardMaterial({color:0x222222}));
  weapon.position.set(0,-0.2,-0.5);
  camera.add(weapon); scene.add(camera);
}

function createTargets(){
  targets=[];
  let count = config.mode==='sixshot'?6:1;
  for(let i=0;i<count;i++){
    let target = new THREE.Mesh(new THREE.SphereGeometry(0.5,16,16), new THREE.MeshStandardMaterial({color:0xff0044}));
    target.position.set(Math.random()*10-5,1+Math.random()*3,-10-Math.random()*10);
    scene.add(target); targets.push(target);
  }
}

function animate(){
  requestAnimationFrame(animate);
  // déplacement
  if(controls.forward)camera.position.z-=0.1;
  if(controls.back)camera.position.z+=0.1;
  if(controls.left)camera.position.x-=0.1;
  if(controls.right)camera.position.x+=0.1;
  renderer.render(scene,camera);
}

function shoot(){
  const raycaster = new THREE.Raycaster();
  raycaster.set(camera.position,new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion));
  const intersects = raycaster.intersectObjects(targets);
  if(intersects.length>0){
    score+=10;
    scoreEl.textContent=score;
    const target=intersects[0].object;
    target.position.set(Math.random()*10-5,1+Math.random()*3,-10-Math.random()*10);
  }
}

function startGame(){
  menu.style.display='none';
  canvasContainer.style.display='block';
  hud.style.display='flex';
  initThree();
  gameInterval = setInterval(()=>{
    timeLeft--; timerEl.textContent=timeLeft;
    if(timeLeft<=0) endGame();
  },1000);
}

function endGame(){
  clearInterval(gameInterval);
  canvasContainer.style.display='none';
  hud.style.display='none';
  endScreen.style.display='flex';
  finalScore.textContent=score;
}
</script>
</body>
</html>
